# We Love Dogs - Web App

Next.js 16 application for a Stellar-based crowdfunding platform helping dogs in need. Features campaign creation, Stellar USDC donations, Proof of Donation (POD) NFTs, and comprehensive care provider dashboards.

_This application can be whitelabeled_

## Getting Started

```bash
# from repo root
cd apps/web
cp .env.local.example .env.local
# edit .env.local (see Environment section below)

npm run dev
```

## Scripts

```bash
npm run dev      # Start development server
npm run build    # Production build (Turbopack)
npm run start    # Start production server
npm run lint     # ESLint
```

## Environment

Set these in `apps/web/.env.local`:

```env
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=

# Stellar Network Configuration
NEXT_PUBLIC_STELLAR_NETWORK=testnet
NEXT_PUBLIC_STELLAR_HORIZON_URL=https://horizon-testnet.stellar.org
NEXT_PUBLIC_STELLAR_SOROBAN_RPC_URL=https://soroban-testnet.stellar.org

# App Configuration
NEXT_PUBLIC_APP_NAME=We Love Dogs
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Wallet Configuration
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=

# Contract Bindings (generated by Stellar CLI)
DONATION_BINDING=donation
POD_POAP_BINDING=pod_poap

# Trustless Work Escrow Configuration
NEXT_PUBLIC_TRUSTLESS_WORK_API_KEY=
NEXT_PUBLIC_PLATFORM_ADDRESS=
NEXT_PUBLIC_DISPUTE_RESOLVER_ADDRESS=
NEXT_PUBLIC_RELEASE_SIGNER_ADDRESS=
NEXT_PUBLIC_TRUSTLINE_ADDRESS=
```

## Key Features

### ğŸ• Dog Campaigns

- Care providers create fundraising campaigns for dogs
- Set fundraising goals, categories (surgery, medication, food, etc.)
- Track funds raised, spent, and campaign progress
- Campaign updates and expense tracking

### ğŸ’ Stellar Donations

- Donate USDC directly on Stellar network
- **Escrow Donations**: Funds held in escrow until proof of expense is provided
- **Instant Donations**: Immediate access to funds for care providers
- Transparent, on-chain transactions
- Real-time donation tracking
- Donation history and statistics

### ğŸ–ï¸ Proof of Donation NFTs

- Receive POD POAP NFTs as commemorative tokens
- NFT gallery for donors
- Metadata includes campaign and dog information

### ğŸ‘¥ User Roles

- **Care Providers**: Create and manage dog profiles and campaigns
- **Donors**: Browse campaigns and make donations
- **Rescuers**: Profile pages for dog rescuers
- **Shelters**: Organization profiles
- **Veterinarians**: Professional profiles

## Wallets

The wallet provider (`contexts/WalletsKitContext.tsx`):

- Persists selected wallet and address in `localStorage`
- Auto-reconnects on reload
- Guards SSR usage (`typeof window` checks)
- Supports xBull, Freighter, WalletConnect, and more

Use the `WalletMenu` from the navbar to connect, view balance, and disconnect.

## UI Components

- Sticky, blurred navbar with gradient brand text
- Hero section showcasing active campaigns
- Dog cards with campaign status
- Donation modal with wallet integration
- Campaign creation forms
- Care provider dashboard
- POD NFT gallery
- Responsive design with Tailwind CSS

---

# Technical Architecture

## Overview

This is a full-stack Web3 application built on Next.js 16, integrating Stellar blockchain capabilities with Supabase backend services. The architecture follows a modern monorepo structure using Turborepo, enabling efficient development and deployment workflows.

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Client Layer (Browser)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Next.js 16 App Router (React 19)                           â”‚
â”‚  â”œâ”€â”€ Pages & Routes (app/)                                  â”‚
â”‚  â”‚   â”œâ”€â”€ Homepage (campaign discovery)                       â”‚
â”‚  â”‚   â”œâ”€â”€ Campaign pages (/donate/[dogId])                    â”‚
â”‚  â”‚   â”œâ”€â”€ Care provider dashboard                             â”‚
â”‚  â”‚   â”œâ”€â”€ User profiles (donor, rescuer, shelter, vet)        â”‚
â”‚  â”‚   â””â”€â”€ Authentication (sign-in, sign-up)                  â”‚
â”‚  â”œâ”€â”€ Server Components & Actions                            â”‚
â”‚  â”œâ”€â”€ Client Components                                      â”‚
â”‚  â””â”€â”€ Middleware (Auth Protection)                           â”‚
â”‚                                                              â”‚
â”‚  Context Providers (React Context API)                      â”‚
â”‚  â”œâ”€â”€ WalletsKitProvider (Wallet State)                      â”‚
â”‚  â”œâ”€â”€ SupabaseProvider (Auth & Data)                         â”‚
â”‚  â””â”€â”€ SorobanProvider (RPC Client)                           â”‚
â”‚                                                              â”‚
â”‚  Custom Hooks                                                â”‚
â”‚  â”œâ”€â”€ useWalletsKit, useDonation, usePodPoap                 â”‚
â”‚  â”œâ”€â”€ useSupabaseAuth, useSupabaseProfile                    â”‚
â”‚  â””â”€â”€ useSoroban, useStellarAccount                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase   â”‚  â”‚   Stellar    â”‚  â”‚   Soroban    â”‚
â”‚   Backend    â”‚  â”‚   Network    â”‚  â”‚   Contracts  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PostgreSQL   â”‚  â”‚ Horizon API  â”‚  â”‚ Donation     â”‚
â”‚ Auth         â”‚  â”‚ Wallets Kit  â”‚  â”‚ POD POAP     â”‚
â”‚ Storage      â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ Realtime     â”‚  â”‚              â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technology Stack

### Frontend Framework

- **Next.js 16**: React framework with App Router
  - Server Components for SEO and performance
  - Server Actions for mutations
  - API Routes for backend integration
  - Middleware for route protection
- **React 19**: Latest React with concurrent features
- **TypeScript**: Type-safe development

### Styling & UI

- **Tailwind CSS 4**: Utility-first CSS framework
- **shadcn/ui**: Accessible component primitives (Radix UI)
- **Lucide React**: Icon library
- **Custom Design System**: Glass morphism effects, gradient branding, paw patterns

### Blockchain Integration

- **Stellar SDK (@stellar/stellar-sdk)**: Core blockchain operations
- **Stellar Wallets Kit (@creit.tech/stellar-wallets-kit)**: Multi-wallet support
  - xBull, Freighter, WalletConnect, and more
  - Persistent wallet connections via localStorage
  - Transaction signing abstraction
- **Soroban RPC**: Smart contract interaction layer

### Backend Services

- **Supabase**: Backend-as-a-Service
  - PostgreSQL database with Row Level Security (RLS)
  - Authentication (email/password, OAuth)
  - Real-time subscriptions for campaign updates
  - Storage buckets for dog images and campaign media
  - Server-side client via `@supabase/ssr`

### Smart Contracts

- **Soroban Contracts** (Rust):
  - `donation`: Tracks donation transactions on-chain
  - `pod-poap`: Proof of Donation NFT minting
- **TypeScript Bindings**: Auto-generated contract clients
- **Dynamic Import**: Runtime contract loading

## Project Structure

```
apps/web/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ (routes)/                 # Application routes
â”‚   â”‚   â”œâ”€â”€ page.tsx              # Homepage with campaign discovery
â”‚   â”‚   â”œâ”€â”€ about/                # About page
â”‚   â”‚   â”œâ”€â”€ how-we-work/          # How it works page
â”‚   â”‚   â”œâ”€â”€ care-providers/       # Care providers listing
â”‚   â”‚   â”œâ”€â”€ donate/               # Donation flow
â”‚   â”‚   â”‚   â””â”€â”€ [dogId]/          # Individual dog campaign page
â”‚   â”‚   â”œâ”€â”€ donation-success/     # Donation confirmation page
â”‚   â”‚   â”œâ”€â”€ profile/              # User profiles
â”‚   â”‚   â”‚   â”œâ”€â”€ care-provider/   # Care provider dashboard
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx      # Dashboard overview
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create-dog/   # Create dog profile
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create-campaign/ # Create campaign
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [dogId]/      # Dog management
â”‚   â”‚   â”‚   â”œâ”€â”€ donor/            # Donor profile
â”‚   â”‚   â”‚   â”œâ”€â”€ rescuer/          # Rescuer profile
â”‚   â”‚   â”‚   â”œâ”€â”€ shelter/          # Shelter profile
â”‚   â”‚   â”‚   â””â”€â”€ veterinary/       # Veterinary profile
â”‚   â”‚   â”œâ”€â”€ register/             # Registration flows
â”‚   â”‚   â”‚   â”œâ”€â”€ care-provider/   # Care provider registration
â”‚   â”‚   â”‚   â””â”€â”€ donor/            # Donor registration
â”‚   â”‚   â”œâ”€â”€ select-user-type/     # User type selection
â”‚   â”‚   â”œâ”€â”€ sign-in/              # Authentication
â”‚   â”‚   â”œâ”€â”€ sign-up/              # Registration
â”‚   â”‚   â””â”€â”€ sign-up-success/      # Registration confirmation
â”‚   â”œâ”€â”€ api/                      # API Routes
â”‚   â”‚   â”œâ”€â”€ donation/             # Donation endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts          # Process donations
â”‚   â”‚   â”‚   â””â”€â”€ stats/            # Donation statistics
â”‚   â”‚   â””â”€â”€ pod-poap/             # NFT endpoints
â”‚   â”‚       â”œâ”€â”€ mint/              # Mint POD NFTs
â”‚   â”‚       â”œâ”€â”€ metadata/         # NFT metadata
â”‚   â”‚       â””â”€â”€ tokens/            # Token queries
â”‚   â”œâ”€â”€ actions/                  # Server Actions
â”‚   â”‚   â”œâ”€â”€ generate-about.ts
â”‚   â”‚   â””â”€â”€ update-quest-progress.ts
â”‚   â”œâ”€â”€ layout.tsx                # Root layout
â”‚   â””â”€â”€ globals.css               # Global styles
â”‚
â”œâ”€â”€ components/                    # React Components
â”‚   â”œâ”€â”€ ui/                       # shadcn/ui primitives
â”‚   â”œâ”€â”€ Navbar.tsx                # Navigation bar
â”‚   â”œâ”€â”€ WalletMenu.tsx            # Wallet connection UI
â”‚   â”œâ”€â”€ DonationButton.tsx        # Donation interface
â”‚   â”œâ”€â”€ DonationModal.tsx         # Donation modal
â”‚   â”œâ”€â”€ DonationStats.tsx         # Statistics display
â”‚   â”œâ”€â”€ donation-story.tsx        # Campaign story component
â”‚   â”œâ”€â”€ sticky-donation-widget.tsx # Sticky donation widget
â”‚   â”œâ”€â”€ dog-card.tsx              # Dog card component
â”‚   â”œâ”€â”€ dog-cards.tsx              # Dog cards grid
â”‚   â”œâ”€â”€ hero.tsx                  # Homepage hero
â”‚   â”œâ”€â”€ care-provider-cards.tsx   # Care provider cards
â”‚   â””â”€â”€ NFT/                      # NFT-related components
â”‚       â”œâ”€â”€ PODGallery.tsx        # Proof of Donation gallery
â”‚       â””â”€â”€ types.ts              # NFT types
â”‚
â”œâ”€â”€ contexts/                      # React Context Providers
â”‚   â”œâ”€â”€ WalletsKitContext.tsx    # Wallet state management
â”‚   â”œâ”€â”€ SupabaseContext.tsx      # Supabase client & auth
â”‚   â””â”€â”€ SorobanContext.tsx        # Soroban RPC client
â”‚
â”œâ”€â”€ hooks/                         # Custom React Hooks
â”‚   â”œâ”€â”€ useWalletsKit.ts          # Wallet operations
â”‚   â”œâ”€â”€ useDonation.ts            # Donation logic
â”‚   â”œâ”€â”€ usePodPoap.ts             # NFT operations
â”‚   â”œâ”€â”€ useSupabaseAuth.ts        # Auth helpers
â”‚   â”œâ”€â”€ useSupabaseProfile.ts     # Profile management
â”‚   â”œâ”€â”€ useSupabaseStorage.ts     # File uploads
â”‚   â”œâ”€â”€ useSupabaseRealtime.ts    # Real-time subscriptions
â”‚   â”œâ”€â”€ useSoroban.ts             # Contract interactions
â”‚   â””â”€â”€ useStellarAccount.ts      # Account queries
â”‚
â”œâ”€â”€ lib/                           # Utility Libraries
â”‚   â”œâ”€â”€ config.ts                 # Environment config
â”‚   â”œâ”€â”€ contracts/                # Contract clients
â”‚   â”‚   â”œâ”€â”€ bindings.ts          # Binding loader utilities
â”‚   â”‚   â”œâ”€â”€ donation.ts          # Donation contract client
â”‚   â”‚   â””â”€â”€ podPoap.ts           # POD POAP contract client
â”‚   â”œâ”€â”€ supabase/                 # Supabase clients
â”‚   â”‚   â”œâ”€â”€ client.ts            # Browser client
â”‚   â”‚   â””â”€â”€ server.ts             # Server client
â”‚   â””â”€â”€ utils/                     # Helper functions
â”‚       â”œâ”€â”€ error-handling.ts
â”‚       â”œâ”€â”€ pod-config.ts
â”‚       â””â”€â”€ pod-metadata.ts
â”‚
â”œâ”€â”€ middleware.ts                 # Next.js middleware (auth)
â”œâ”€â”€ next.config.ts                # Next.js configuration
â”œâ”€â”€ tailwind.config.ts            # Tailwind configuration
â””â”€â”€ tsconfig.json                 # TypeScript configuration
```

## Data Flow

### Authentication Flow

1. User visits protected route (`/profile/*`)
2. Middleware checks Supabase session
3. If unauthenticated â†’ redirect to `/sign-in`
4. On sign-in â†’ Supabase creates session
5. Session stored in HTTP-only cookies (via `@supabase/ssr`)
6. Context providers sync auth state

### Campaign Creation Flow

1. Care provider logs in and navigates to dashboard
2. Creates dog profile with images and condition details
3. Creates campaign with fundraising goal and categories
4. Campaign appears on homepage and care providers page
5. Campaign status tracked in real-time

### Donation Flow

1. User browses campaigns on homepage or care providers page
2. Clicks on dog card to view campaign details
3. Connects wallet via `WalletMenu`
4. Initiates donation via `DonationButton` or sticky widget
5. Hook (`useDonation`) builds Stellar USDC payment transaction
6. User signs transaction via wallet
7. Signed transaction submitted to Horizon API
8. On success â†’ donation recorded in Supabase
9. Optional: POD NFT minted via POD POAP contract
10. User redirected to donation success page

### Smart Contract Interaction Flow

1. Contract bindings loaded dynamically (`lib/contracts/*`)
2. Contract client created with network config
3. User action triggers contract method call (e.g., mint NFT)
4. Transaction built with Stellar SDK
5. User signs via `WalletsKitProvider.signTransaction`
6. Transaction submitted to Soroban RPC
7. Contract state updated on-chain

## State Management

### React Context API

The application uses React Context for global state:

- **WalletsKitContext**: Wallet connection state, address, network
- **SupabaseContext**: Auth session, user data, client instances
- **SorobanContext**: RPC client, health status

### Local State

- Component-level state via `useState` for UI state
- Form state via controlled components
- Server state via React Server Components

### Persistence

- **localStorage**: Wallet selection and address
- **Cookies**: Supabase session (HTTP-only, secure)
- **Supabase Database**: User profiles, dogs, campaigns, donations, transactions

## Security Considerations

### Authentication

- Supabase Row Level Security (RLS) policies
- Server-side session validation in middleware
- Protected API routes check auth status
- Role-based access control for different user types

### Wallet Security

- Private keys never exposed (wallet extension handles)
- Transaction signing happens in wallet
- XDR (transaction) validation before signing
- Network validation (testnet/mainnet)

### API Security

- Environment variables for sensitive config
- Server-side contract client creation
- Rate limiting (via Supabase/Next.js)
- Input validation and sanitization

## Performance Optimizations

### Next.js Optimizations

- Server Components for reduced client bundle
- Code splitting via dynamic imports
- Image optimization via `next/image`
- Static generation where possible

### React Optimizations

- Context providers memoized
- Custom hooks with dependency arrays
- Lazy loading for heavy components
- Optimistic updates for donations

### Blockchain Optimizations

- Contract bindings loaded on-demand
- RPC calls cached where appropriate
- Batch operations for multiple queries
- Transaction polling with exponential backoff

## Deployment

### Build Process

1. TypeScript compilation
2. Next.js production build
3. Contract bindings bundled
4. Static assets optimized

### Environment Variables

Required for production:

- Supabase URL and keys
- Stellar network configuration (testnet/mainnet)
- Contract IDs and bindings
- WalletConnect project ID

### Hosting

- Compatible with Vercel, Netlify, or any Node.js host
- Edge runtime support for middleware
- Static export possible for static routes

## Development Workflow

### Local Development

1. Start Supabase: `cd apps/backend && npm run dev`
2. Start web app: `cd apps/web && npm run dev`
3. Build contracts: `cd contracts && npm run build`
4. Generate types: `cd apps/backend && npm run types`

### Contract Development

1. Write contract in `contracts/contracts/*/src/lib.rs`
2. Build: `cd contracts && npm run build`
3. Generate bindings: `stellar contract bindings typescript`
4. Update env vars with contract ID
5. Import in app via `lib/contracts/*`

## Testing Strategy

### Unit Tests

- React components (React Testing Library)
- Utility functions
- Contract bindings

### Integration Tests

- API routes
- Contract interactions
- Database operations

### E2E Tests

- User flows (donation, wallet connection)
- Authentication flows
- Campaign creation and management
- Contract deployment and interaction

## Monitoring & Analytics

- **Vercel Analytics**: Performance monitoring
- **Supabase Logs**: Database and auth events
- **Stellar Horizon**: Transaction tracking
- **Error Tracking**: (To be implemented)

## Future Enhancements

- [ ] Multi-chain support
- [ ] Advanced NFT features (rarity, collections)
- [ ] Real-time notifications
- [ ] Analytics dashboard for care providers
- [ ] Mobile app (React Native)
- [ ] GraphQL API layer
- [ ] Contract upgradeability patterns
- [ ] Recurring donations
- [ ] Social sharing features
- [ ] Campaign milestones and updates
